(function(){$(function(){var i=abp.services.app.user,n=$("#dlg"),r=$("#dg"),u=n.find("form"),t;i.getRoles().done(function(n){$("#roleName").combobox({data:n.items,valueField:"name",textField:"displayName"})});$("#tb").children('a[name="add"]').click(function(){n.dialog("open").dialog("setTitle","增加");u.form("clear");$("#UserName").next("span").find("input").focus()});$("#tb").children('a[name="edit"]').click(function(){if(t=$("#dg").datagrid("getSelected"),!t){abp.notify.error("选择要修改的用户","",{positionClass:"toast-top-center"});return}n.dialog("open").dialog("setTitle","修改");u.form("load",t);$("#UserName").attr("readonly","readonly")});$("#tb").children('a[name="remove"]').click(function(){if(t=r.datagrid("getSelected"),!t){abp.notify.error("选择要删除的行","",{positionClass:"toast-top-center"});return}abp.message.confirm("确定删除这一行吗？","请确定",function(u){u&&i.delete(t).done(function(){abp.notify.info(t.name+" 被删除！");n.dialog("close");r.datagrid("reload")})})});$("#tb").children('a[name="resetPassword"]').click(function(){if(t=r.datagrid("getSelected"),!t){abp.notify.error("请先选择用户","",{positionClass:"toast-top-center"});return}abp.message.confirm("确定重置此角色用户密码吗？","请确定",function(u){u&&(abp.ui.setBusy(n),i.resetRoleUserPassword(t.userName).done(function(){abp.notify.info("成功重置角色缺省用户密码")}).always(function(){abp.ui.clearBusy(r)}))})});$("#dlg-tb").children('a[name="save"]').click(function(f){var e,o;(f.preventDefault(),u.form("validate"))&&(e=u.serializeFormToObject(),abp.ui.setBusy(n),n.panel("options").title==="增加"?(e.surname=e.name,e.emailAddress=e.name+"@163.com",e.isActive=!0,e.roleNames=[e.roleName],o=i.create(e)):o=i.update(t.id,e),o.done(function(){abp.notify.info(n.panel("options").title+"操作成功");n.dialog("close");r.datagrid("reload")}).always(function(){abp.ui.clearBusy(n)}))});$("#dlg-tb").children('a[name="cancel"]').click(function(){n.dialog("close")})})})();
(function(){$(function(){var r=abp.services.app.role,t=$("#dgRole"),n=$("#dlg"),u=n.find("form"),i=null;$("#dg").datagrid({url:"Roles/GridData",onSelect:function(n,r){i=r.tenancyName;t.datagrid({url:"Roles/GetTenantRoles/"+i})}});t.datagrid({onSelect:function(n,t){$("#dgPermission").datagrid("clearChecked");r.getRolePermissionNames(i,t.id).done(function(n){var t=$("#dgPermission").datagrid("getRows");$.each(n,function(n,i){$.each(t,function(n,t){t.Name===i&&$("#dgPermission").datagrid("checkRow",n)})})})}});$("#tb").children('a[name="add"]').click(function(){n.dialog("open");_$fm.form("clear");$("#Name").next("span").find("input").focus()});$("#tb").children('a[name="remove"]').click(function(){let i=t.datagrid("getSelected");if(!i){abp.notify.error("选择要删除的行","",{positionClass:"toast-top-center"});return}abp.message.confirm("确定删除这一行吗？","请确定",function(u){u&&r.removeRole(tenancyName,i.name).done(function(){n.dialog("close");t.datagrid("reload")})})});$("#dlg-tb").children('a[name="save"]').click(function(f){if(f.preventDefault(),u.form("validate")){var e=u.serializeFormToObject();abp.ui.setBusy(n);r.createTenantRole(i,e).done(function(){n.dialog("close");t.datagrid("reload")}).always(function(){abp.ui.clearBusy(n)})}});$("#dlg-tb").children('a[name="cancel"]').click(function(){n.dialog("close")});$("#tb").children('a[name="grant"]').click(function(){var f=$("#dgPermission").datagrid("getChecked"),o,e,u;if(f.length>0){for(o=t.datagrid("getSelected").id,e=[],u=0;u<f.length;u++)e.push(f[u].Name);abp.ui.setBusy(n);r.updateRolePermissions(i,{RoleId:o,GrantedPermissionNames:e}).done(function(){abp.notify.info("成功授权")}).always(function(){abp.ui.clearBusy(n)})}})})})();